#!/usr/bin/env bash
set -e

JOBNAME=${1:-ospm}
WALLTIME=${2:-01:00:00}
PARTITION=${3:-normal}

OUT="slurm_${JOBNAME}.slurm"

cat > "$OUT" <<EOF
#!/bin/bash
#SBATCH --job-name=${JOBNAME}
#SBATCH --time=${WALLTIME}
#SBATCH --partition=${PARTITION}
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=1
#SBATCH --mem=4G
#SBATCH --output=slurm_%j.out
#SBATCH --error=slurm_%j.err

set -e
cd \$SLURM_SUBMIT_DIR

echo "[SLURM] Job started on \$(hostname)"
echo "[SLURM] Start time: \$(date)"

bash utils/start

echo "[SLURM] End time: \$(date)"
EOF

chmod +x "$OUT"

echo "[mk_slurm] Wrote $OUT"
