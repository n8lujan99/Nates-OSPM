#!/usr/bin/env bash
# Utils/check
#
# Galaxy-level OSPM sanity check wrapper.
#
# Usage:
#   bash Utils/check

set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
CHECK_SCRIPT="$ROOT_DIR/OSPM/check_galaxy_model.py"
WHICH_FILE="$ROOT_DIR/which_galaxy"

if [ ! -f "$WHICH_FILE" ]; then
    echo "[ERROR] which_galaxy file not found at repo root"
    exit 1
fi

GALAXY="$(cat "$WHICH_FILE" | tr -d '[:space:]')"

if [ -z "$GALAXY" ]; then
    echo "[ERROR] which_galaxy is empty"
    exit 1
fi

if [ ! -f "$CHECK_SCRIPT" ]; then
    echo "[ERROR] check_galaxy_model.py not found at:"
    echo "        $CHECK_SCRIPT"
    exit 1
fi

echo "[CHECK] Repo root: $ROOT_DIR"
echo "[CHECK] Galaxy: $GALAXY"
echo

cd "$ROOT_DIR"

# Activate venv if present
if [ -d "$ROOT_DIR/.venv" ]; then
    source "$ROOT_DIR/.venv/bin/activate"
fi

# Inject repo context
export PYTHONPATH="$ROOT_DIR"

python "$CHECK_SCRIPT"
