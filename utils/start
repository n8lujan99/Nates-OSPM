#!/usr/bin/env bash
set -e

ROOT="$(cd "$(dirname "$0")/.." && pwd)"
WHICH_FILE="$ROOT/which_galaxy"

if [ ! -f "$WHICH_FILE" ]; then
    echo "[ERROR] which_galaxy file not found at repo root"
    exit 1
fi

GALAXY="$(cat "$WHICH_FILE" | tr -d '[:space:]')"

if [ -z "$GALAXY" ]; then
    echo "[ERROR] which_galaxy is empty"
    exit 1
fi

echo "[START] Repo root: $ROOT"
echo "[START] Galaxy: $GALAXY"

source "$ROOT/.venv/bin/activate"

export PYJULIA_USE_PYTHONCALL=1
export OSPM_USE_JULIA=1
export PYTHONPATH="$ROOT"
export JULIA_NUM_THREADS=1
python -m OSPM.Controllers.OSPM_RUN
