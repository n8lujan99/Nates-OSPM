#!/bin/bash
set -euo pipefail

if [[ $# -ne 1 ]]; then
    echo "Usage: batch_start <GalaxyName>"
    exit 1
fi

GALAXY="$1"
REPO_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
GAL_DIR="$REPO_ROOT/Data/Gal_Profiles/$GALAXY"

if [[ ! -d "$GAL_DIR" ]]; then
    echo "[FATAL] Galaxy '$GALAXY' not found"
    exit 1
fi

echo "[INFO] Preparing SLURM run for galaxy: $GALAXY"

echo "$GALAXY" > "$REPO_ROOT/which_galaxy"

mkdir -p "$REPO_ROOT/logs"

sbatch "$REPO_ROOT/data/slurm"
