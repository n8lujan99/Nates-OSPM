#!/usr/bin/env bash
set -e

if [ ! -d ".venv" ]; then
    echo "ERROR: .venv not found. Create it with:"
    echo "  python -m venv .venv"
    exit 1
fi

source .venv/bin/activate

REQUIRED_PIP="24.0"
CURRENT_PIP=$(pip --version | awk '{print $2}')

if [ "$CURRENT_PIP" != "$REQUIRED_PIP" ]; then
    echo "ERROR: pip version $CURRENT_PIP detected, expected $REQUIRED_PIP"
    echo "Run:"
    echo "  pip install --upgrade pip==$REQUIRED_PIP"
    exit 1
fi

export PYJULIA_USE_PYTHONCALL=1
export OSPM_USE_JULIA=1

# FIXED
export PYTHONPATH="$(pwd)"

python -m OSPM.OSPM_RUN
